<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ –ü—Ä–µ–¥–∏–∑–≤–∏–∫–∞—Ç–µ–ª—Å—Ç–≤–æ 1-10 –ö–ª–∞—Å</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a5cc025;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        #game-container {
            background-color: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            text-align: center;
        }
        h1 { color: #2c3e50; margin-bottom: 0.5rem; font-size: 1.5rem;}
        #stats-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1rem;
        }
        .stat-box {
            background-color: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        #timer-box { background-color: #e67e22; }
        #question {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            min-height: 60px;
            color: #34495e;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        button.quiz-btn {
            padding: 12px;
            font-size: 1.1rem;
            border: 2px solid #3498db;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }
        button.quiz-btn:hover {
            background-color: #3498db;
            color: white;
        }
        #message { margin-top: 1.5rem; font-weight: bold; height: 24px; }
        .correct { color: #27ae60; }
        .wrong { color: #e74c3c; }
        .hidden { display: none !important; }
        
        #restart-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            margin-top: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        /* --- –ú–∏–Ω–∏-–∏–≥—Ä–∞ --- */
        canvas {
            border: 2px solid #333;
            background-color: #87CEEB;
            border-radius: 8px;
            margin-top: 10px;
            touch-action: none;
        }

        /* --- Loading Screen --- */
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="game-container">
    <h1>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h1>
    
    <div id="stats-bar">
        <div class="stat-box">–ö–ª–∞—Å: <span id="current-grade">1</span></div>
        <div class="stat-box" id="timer-box">–í—Ä–µ–º–µ: <span id="timer">05:00</span></div>
    </div>
    
    <div id="quiz-section">
        <div id="question">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
        <div class="options-grid" id="options"></div>
        <p id="message"></p>
    </div>

    <div id="minigame-section" class="hidden">
        <p style="font-weight: bold; color: #ff6600;">–ë—Ä–∞–≤–æ! –ü—Ä–µ—Å–∫–æ—á–∏ 3 –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è!</p>
        <canvas id="gameCanvas" width="480" height="250"></canvas>
        <p>–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è: <span id="score">0</span> / 3</p>
    </div>

    <div id="loading-section" class="hidden">
        <h2>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–ª–µ–¥–≤–∞—â–∏—è –≤—ä–ø—Ä–æ—Å...</h2>
        <div class="loader"></div>
    </div>

    <div id="result-section" class="hidden">
        <h2 id="final-status"></h2>
        <p id="final-message"></p>
        <button id="restart-btn" onclick="restartGame()">–ò–≥—Ä–∞–π –ø–∞–∫</button>
    </div>
</div>

<script>
    const questions = [
        { grade: 1, q: "–ö–æ–ª–∫–æ –µ 7 + 5?", options: ["11", "12", "13", "14"], correct: 1 },
        { grade: 2, q: "–ü—Ä–µ—Å–º–µ—Ç–Ω–∏: 4.8", options: ["24", "32", "36", "40"], correct: 1 },
        { grade: 3, q: "–ö–æ–ª–∫–æ –µ 150 - 65?", options: ["85", "75", "95", "65"], correct: 0 },
        { grade: 4, q: "–ö–æ–ª–∫–æ –µ 1/4 –æ—Ç 100?", options: ["20", "25", "30", "50"], correct: 1 },
        { grade: 5, q: "–ö–æ–ª–∫–æ –∫–≤.—Å–º –µ –ª–∏—Ü–µ—Ç–æ –Ω–∞ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫ —Å—ä—Å —Å—Ç—Ä–∞–Ω–∏ 6 —Å–º –∏ 8 —Å–º?", options: ["14 –∫–≤.—Å–º", "48 –∫–≤.—Å–º", "28 –∫–≤.—Å–º", "24 –∫–≤.—Å–º"], correct: 1 },
        { grade: 6, q: "–ü—Ä–µ—Å–º–µ—Ç–Ω–∏: -5 + (-12)", options: ["7", "-7", "17", "-17"], correct: 3 },
        { grade: 7, q: "–ê–∫–æ 2.—Ö = 10, –Ω–∞ –∫–æ–ª–∫–æ –µ —Ä–∞–≤–Ω–æ —Ö?", options: ["2", "5", "8", "20"], correct: 1 },
        { grade: 8, q: "–ö–æ–ª–∫–æ –µ –∫–æ—Ä–µ–Ω –∫–≤–∞–¥—Ä–∞—Ç–µ–Ω –æ—Ç 144?", options: ["10", "11", "12", "14"], correct: 2 },
        { grade: 9, q: "–†–µ—à–∏: x¬≤ = 25", options: ["5", "10", "25", "50"], correct: 0 },
        { grade: 10, q: "–ù–∞ –∫–æ–ª–∫–æ –µ —Ä–∞–≤–µ–Ω —Å–∏–Ω—É—Å –æ—Ç 90 –≥—Ä–∞–¥—É—Å–∞?", options: ["0", "0.5", "1", "-1"], correct: 2 }
    ];

    let currentStep = 0;
    let timerInterval;
    let timeLeft = 300; 

    const sections = {
        quiz: document.getElementById('quiz-section'),
        mini: document.getElementById('minigame-section'),
        load: document.getElementById('loading-section'),
        res: document.getElementById('result-section')
    };

    function switchSection(name) {
        Object.keys(sections).forEach(s => sections[s].classList.add('hidden'));
        sections[name].classList.remove('hidden');
    }

    function startTimer() {
        timeLeft = 300;
        updateTimerDisplay();
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                showEndGame(false, "–í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ! –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞—Ç–∞ –∏–∑–∏—Å–∫–≤–∞ –±—ä—Ä–∑–∏–Ω–∞.");
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const mins = Math.floor(timeLeft / 60);
        const secs = timeLeft % 60;
        document.getElementById('timer').innerText = 
            `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function loadQuestion() {
        if (currentStep >= questions.length) {
            showEndGame(true);
            return;
        }
        switchSection('quiz');
        const currentQ = questions[currentStep];
        document.getElementById('current-grade').innerText = currentQ.grade;
        document.getElementById('question').innerText = currentQ.q;
        const optionsEl = document.getElementById('options');
        optionsEl.innerHTML = '';
        document.getElementById('message').innerText = '';

        currentQ.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.className = 'quiz-btn';
            btn.onclick = () => {
                if (index === currentQ.correct) {
                    clearInterval(timerInterval);
                    document.getElementById('message').innerText = "–ü—Ä–∞–≤–∏–ª–Ω–æ!";
                    document.getElementById('message').className = "correct";
                    setTimeout(startMiniGame, 800);
                } else {
                    clearInterval(timerInterval);
                    showEndGame(false, "–ì—Ä–µ—à–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä! –û–ø–∏—Ç–∞–π –ø–∞–∫.");
                }
            };
            optionsEl.appendChild(btn);
        });
        startTimer();
    }

    // --- –õ–æ–≥–∏–∫–∞ –Ω–∞ –ú–∏–Ω–∏-–∏–≥—Ä–∞—Ç–∞ ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let gameRunning = false, obstaclesPassed = 0, isFinishing = false, waitingOnGround = false;
    let player = { x: 50, y: 170, width: 30, height: 30, color: '#e74c3c', vY: 0, isG: false };
    let obstacles = [];
    const gravity = 0.8, groundY = 220, gameSpeed = 5;

    function startMiniGame() {
        switchSection('mini');
        gameRunning = true;
        obstaclesPassed = 0;
        isFinishing = false;
        waitingOnGround = false;
        obstacles = [];
        player.y = groundY - player.height;
        player.vY = 0;
        document.getElementById('score').innerText = "0";
        updateGame();
        spawnObstacle();
    }

    function spawnObstacle() {
        if (!gameRunning || isFinishing) return;
        let h = Math.random() * 30 + 20;
        obstacles.push({ x: canvas.width, y: groundY - h, w: 20, h: h, p: false });
        if (obstaclesPassed + obstacles.length < 4) setTimeout(spawnObstacle, 1200);
    }

    function updateGame() {
        if (!gameRunning) return;
        let animationId = requestAnimationFrame(updateGame);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#2ecc71';
        ctx.fillRect(0, groundY, canvas.width, 30);

        player.vY += gravity;
        player.y += player.vY;

        if (player.y >= groundY - player.height) {
            player.y = groundY - player.height;
            player.vY = 0;
            player.isG = true;

            if (isFinishing && !waitingOnGround) {
                waitingOnGround = true;
                setTimeout(() => {
                    gameRunning = false;
                    cancelAnimationFrame(animationId);
                    handleMiniGameWin();
                }, 500); // –ü–æ–ª–æ–≤–∏–Ω —Å–µ–∫—É–Ω–¥–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ –Ω–∞ –∑–µ–º—è—Ç–∞
            }
        } else { player.isG = false; }

        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            if (!waitingOnGround) o.x -= gameSpeed;
            ctx.fillStyle = '#34495e';
            ctx.fillRect(o.x, o.y, o.w, o.h);

            if (player.x < o.x + o.w && player.x + player.width > o.x &&
                player.y < o.y + o.h && player.y + player.height > o.y) {
                gameRunning = false;
                showEndGame(false, "–£–¥–∞—Ä–∏ —Å–µ –≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ!");
                return;
            }
            if (o.x + o.w < player.x && !o.p) {
                o.p = true;
                obstaclesPassed++;
                document.getElementById('score').innerText = obstaclesPassed;
                if (obstaclesPassed >= 3) isFinishing = true;
            }
        }
    }

    function handleMiniGameWin() {
        currentStep++;
        if (currentStep < questions.length) {
            switchSection('load');
            setTimeout(loadQuestion, 3000); // 3 —Å–µ–∫—É–Ω–¥–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        } else {
            showEndGame(true);
        }
    }

    function jump() { if (gameRunning && player.isG && !waitingOnGround) player.vY = -12; }
    document.addEventListener('keydown', e => { if(e.code==='Space') { e.preventDefault(); jump(); }});
    canvas.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, {passive:false});

    function showEndGame(win, msg) {
        clearInterval(timerInterval);
        gameRunning = false;
        switchSection('res');
        document.getElementById('final-status').innerText = win ? "üèÜ –¢–ò –°–ò –ú–ê–¢–ï–ú–ê–¢–ò–ö!" : "üò¢ –ö–†–ê–ô –ù–ê –ò–ì–†–ê–¢–ê";
        document.getElementById('final-message').innerText = win ? "–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è! –ü—Ä–µ–º–∏–Ω–∞ –ø—Ä–µ–∑ –≤—Å–∏—á–∫–∏ –Ω–∏–≤–∞ —É—Å–ø–µ—à–Ω–æ." : msg;
    }

    function restartGame() {
        currentStep = 0;
        switchSection('quiz');
        loadQuestion();
    }

    loadQuestion();
</script>
</body>
</html>